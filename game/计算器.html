<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>烽火必出蛋刀</title>
</head>
<body>
  <div class="outer" id="outer" style="background-image: url('./3.jpeg');">
    <div style="opacity: 0.90;padding-top: 30px">
      <div class="wrapper">
        <div class="title">烽火——g团助手V1.0</div>
        <div class="subTitle">作者：
          <span class="red">觅心者-鬼子不服</span>
        </div>
      </div>
      <div class="wrapper">
        <div class="title">记账器：</div>
        <button class="button" onclick="listAdd()">添加</button>
        <div id="list">
          <div class="listItem">
            <span>物品:</span><input class="itemSelf input"/>
            <span>价格:</span><input type='number' class="price input"/>
            <span>玩家</span><input class="getPlayer input"/>
            <span>赊账</span><input type="checkbox" class="payed"/>
            <span>实际支付</span><input placeholder="不赊账不用填" type='number' class="payedMoney"/>
          </div>
        </div>

        <button style="margin-top: 10px" class="button" onclick="getListResult()">结算</button>
        <div class="item">
          <div>
            <span>详细描述:</span>
          </div>
        </div>
        <div>
          <span id="resultDetail"></span>
        </div>
      </div>
      <div class="wrapper">
        <div class="title">计算器：</div>
        <div class="item">
          <span class="item-label">总收入:</span>
          <input id="sum" class="input" type="number" value="5000"/>
        </div>
        <div class="item">
          <span class="item-label">总人数:</span>
          <input id="count" class="input" type="number" value="25"/>
        </div>
        <div class="item">
          <span class="item-label">T人数:</span>
          <input id="tCount" class="input" type="number" value="0"/>
          <span class="item-label">T补助:</span>
          <input id="tSubsidy" class="input" type="number" value="100"/>
        </div>
        <div class="item">
          <span class="item-label">N人数:</span>
          <input id="nCount" class="input" type="number" value="0"/>
          <span class="item-label">N补助:</span>
          <input id="nSubsidy" class="input" type="number" value="100"/>
        </div>
        <div class="item">
          <span class="item-label">SM人数:</span>
          <input id="smCount" class="input" type="number" value="0"/>
          <span class="item-label">SM补助:</span>
          <input id="smSubsidy" class="input" type="number" value="200"/>
        </div>
        <div id="subsidyAdd">
          <button class="button" onclick="subsidyAdd()">自定义补助</button>
        </div>
        <div class="item">
          <span class="item-label">摸尸分红:</span>
          <input id="deadBodyPower" class="input" placeholder="摸尸佬(不填默认无)"/>
          <span class="item-label">分红收入:</span>
          <input id="deadBodyLimit" class="input" type="number" value="5000"/>
        </div>
        <div class="item">
          <span class="item-label">分红百分比:</span>
          <input id="deadBodyRate" class="input" type="number" value="2"/>
        </div>
        <div class="item">
          <span class="item-label">人均:</span>
          <span id="perCapita" class="input" type="number">0</span>
        </div>
        <div class="item">
          <button class="button" onclick="getResult()" type="number">计算</button>
        </div>
        <div class="item">
          <div>
            <span>详细描述:</span>
          </div>
        </div>
        <div>
          <span id="detail"></span>
        </div>
      </div>
    </div>

    <div class="adv-left adv-left-1">
      <div class="adv-title">未出蛋刀记录</div>
      <div class="adv-des">5</div>
    </div>
    <div class="adv-left adv-left-2">
      <div class="adv-title">买油就找</div>
      <div class="adv-des">鬼子不服</div>
    </div>
    <div class="adv-right adv-right-1">
      <div class="adv-title">著名小黑手</div>
      <div class="adv-des">安笑、肥牛、列侬</div>
    </div>
    <div class="adv-right adv-right-2">
      <div class="adv-title">广告位招租</div>
    </div>
  </div>
</body>
</html>
<script>
  window.onload = function(){
    const index = ~~(Math.random() * 3) + 1
    const dom = document.getElementById('outer')
    console.log(dom.style.backgroundImage)
    dom.style.backgroundImage = "url('./"+ index +".jpeg')"
  }

  function getResult(){
    const sumValue = ~~document.getElementById('sum').value
    const perCapitaDom = document.getElementById('perCapita')
    const subsidyAddCountDoms= document.getElementsByClassName('subsidyAddCount') // 额外补助人数
    const subsidyAddPriceDoms= document.getElementsByClassName('subsidyAddPrice') // 额外补助价格
    const subsidyAddCountArray= [...subsidyAddCountDoms] // 额外补助人数
    const subsidyAddPriceArray= [...subsidyAddPriceDoms] // 额外补助价格
    const count = document.getElementById('count').value // 人数
    const detailDom = document.getElementById('detail') // 详细数据
    const deadBodyPower = document.getElementById('deadBodyPower').value // 分红人
    const deadBodyLimit = document.getElementById('deadBodyLimit').value // 分红收入
    const deadBodyRate = document.getElementById('deadBodyRate').value // 分红百分比
    let deadBodyIncome = 0
    let perCapita = 0
    let subsidy = 0

    if(count<=0){
      alert('人数不对,没法算')
      return
    }
    const tSingleSubsidy = ~~document.getElementById('tSubsidy').value
    const nSingleSubsidy = ~~document.getElementById('nSubsidy').value
    const smSingleSubsidy = ~~document.getElementById('smSubsidy').value
    const tSubsidy = ~~document.getElementById('tCount').value * tSingleSubsidy
    const nSubsidy = ~~document.getElementById('nCount').value * nSingleSubsidy
    const smSubsidy = ~~document.getElementById('smCount').value * smSingleSubsidy

    let otherSubsidy = 0
    subsidyAddCountArray.forEach((i,index) => {
      otherSubsidy += i.value * subsidyAddPriceArray[index].value
    })
    subsidy = tSubsidy + nSubsidy + smSubsidy + otherSubsidy
    if(deadBodyPower && (~~deadBodyLimit <= ~~sumValue)){
      deadBodyIncome = sumValue * (deadBodyRate/100)
      perCapita = (sumValue * (1 - deadBodyRate/100) - subsidy) / count
    }else{
      perCapita = (sumValue - subsidy) / count
    }
    perCapitaDom.innerHTML = perCapita
    detailDom.innerHTML = [
      "本次g团总收入为:" , sumValue , "</br>",
      "分金人数为:" , count , "</br>",
      "是否存在分红：",deadBodyIncome>0 ? "存在。" : "不存在", deadBodyIncome>0 ? deadBodyPower+"分红"+deadBodyIncome : "", "</br>",
      "坦克人员总补助" , tSubsidy ,",占比" , (tSubsidy/sumValue * 100).toFixed(2)+"%" , "</br>",
      "治疗人员总补助" , nSubsidy ,",占比" , (nSubsidy/sumValue * 100).toFixed(2)+"%" , "</br>",
      "萨满人员总补助" , smSubsidy ,",占比" , (smSubsidy/sumValue * 100).toFixed(2)+"%" , "</br>",
      "自定义补助" , otherSubsidy ,",占比" , (otherSubsidy/sumValue * 100).toFixed(2)+"%" , "</br>",
      "总补助" , subsidy ,",总占比" , (subsidy/sumValue * 100).toFixed(2)+"%" , "</br>",
      "普通打工人收入" , perCapita ,",占比" , (perCapita/sumValue * 100).toFixed(2)+"%" , "</br></br>",

      "普通打工人收入(向下取整，下同):" , getIntNumber(perCapita) ,"</br>",
      "坦克打工人收入:" , getIntNumber(perCapita+tSingleSubsidy) ,"</br>",
      "治疗打工人收入:" , getIntNumber(perCapita+nSingleSubsidy) ,"</br>",
      "萨满打工人收入:" , getIntNumber(perCapita+smSingleSubsidy) ,"</br>",
    ].reduce((a,b) => a+b)
  }

  function getIntNumber(number){
    return Math.floor(number)
  }

  function listAdd(){
    const listDom = document.getElementById("list")
    const addDom = document.createElement('div')
    addDom.classList.add('listItem')
    addDom.innerHTML = "<span>物品:</span><input class=\"itemSelf input\"/>\n" +
            "            <span>价格:</span><input type='number' class=\"price input\"/>\n" +
            "            <span>玩家</span><input class=\"getPlayer input\"/>\n" +
            "            <span>赊账</span><input type=\"checkbox\" class=\"payed\"/>\n" +
            "            <span>实际支付</span><input placeholder=\"不赊账不用填\" type='number' class=\"payedMoney\"/>"
    listDom.append(addDom)
  }

  function subsidyAdd(){
    const listDom = document.getElementById("subsidyAdd")
    const addDom = document.createElement('div')
    addDom.classList.add('subsidyAddItem')
    addDom.innerHTML = "<div class=\"item\">\n" +
            "          <input class=\"item-label\" value='补助人数:'/>\n" +
            "          <input class=\"input subsidyAddCount\" type=\"number\" value=\"0\"/>\n" +
            "          <input class=\"item-label\" value='补助单价:' />\n" +
            "          <input class=\"input subsidyAddPrice\" type=\"number\" value=\"200\"/>\n" +
            "        </div>"
    listDom.append(addDom)
  }

  function getListResult(){
    const listItem = document.getElementsByClassName('listItem')
    const priceDoms = document.getElementsByClassName('price')
    const payedDoms = document.getElementsByClassName('payed')
    const payedMoneyDoms = document.getElementsByClassName('payedMoney')
    const getPlayerDoms = document.getElementsByClassName('getPlayer')
    const resultDetailDom = document.getElementById('resultDetail')
    const priceDomsArray = [...priceDoms]
    const payedDomsArray = [...payedDoms]
    const payedMoneyDomsArray = [...payedMoneyDoms]
    const getPlayerDomsArray = [...getPlayerDoms]

    const priceValueArray = priceDomsArray.map(i => ~~i.value)
    const payedValueArray = payedDomsArray.map(i => i.checked)
    const payedMoneyValueArray = payedMoneyDomsArray.map(i => ~~i.value)
    const getPlayerValueArray = getPlayerDomsArray.map(i => i.value)

    const totalPrice = priceValueArray.reduce((a,b) => a+b)
    const unPayedArray = priceValueArray.map((i, index)=>{
      return i - (payedMoneyValueArray[index] || 0)
    }).filter((i,index)=>{
      return payedValueArray[index]
    })
    const getPlayerArray = getPlayerValueArray.filter((i,index)=>{
      return payedValueArray[index]
    })
    const unPayedTotal = (unPayedArray).reduce((a,b) => a+b,0)
    console.log(getPlayerArray)
    const unPayedPlayer = Array.from(new Set(getPlayerArray)).reduce((a,b) => a+b+",","")
    resultDetailDom.innerHTML = [
      "总收入:",totalPrice,"<br/>",
      "未收到欠款:",unPayedTotal,"<br/>",
      "催账找:",unPayedPlayer,"<br/>"
    ].reduce((a,b) => a+b)
  }
</script>
<style>
  html{
    height: 100%;
    color: #314659;
    background: #e0e0e0;
    margin: 0;
    padding: 0;
  }
  body{
    height: 100%;
    margin: 0;
    padding: 0;
  }
  .outer{
    width: 100%;
    height: 100%;
    background-size: 100%;
    overflow: scroll;
    position: relative;
  }
  .adv-left{
    opacity: 0.9;
    position: absolute;
    width: 180px;
    height: 130px;
    padding: 12px;
    border: 1px solid #eeeeee;
    border-radius: 5px;
    left: 10px;
    background: #eeeeee;
    text-align: center;
  }
  .adv-left-1{
    top: 50px;
  }
  .adv-left-2{
    top: 250px;
  }
  .adv-right{
    opacity: 0.9;
    position: absolute;
    width: 180px;
    height: 130px;
    padding: 12px;
    border: 1px solid #eeeeee;
    border-radius: 5px;
    right: 10px;
    background: #eeeeee;
    text-align: center;
  }
  .adv-right-1{
    top: 50px;
  }
  .adv-right-2{
    top: 250px;
  }
  .adv-title{
    margin-top: 20px;
    font-size: 18px;
    font-weight: 600;
  }
  .adv-des{
    margin-top: 20px;
    color: #1890ff;
  }
  .input{
    box-sizing: border-box;
    margin: 0;
    font-variant: tabular-nums;
    list-style: none;
    font-feature-settings: "tnum";
    position: relative;
    display: inline-block;
    width: 120px;
    height: 24px;
    padding: 4px 11px;
    color: rgba(0,0,0,.65);
    font-size: 14px;
    line-height: 1.5;
    background-color: #fff;
    background-image: none;
    border: 1px solid #d9d9d9;
    border-radius: 4px;
    transition: all .3s;
    margin-left: 10px;
  }
  .listItem{
    margin-bottom: 8px;
  }
  .wrapper{
    width: 800px;
    margin: 10px auto;
    border-radius: 5px;
    border: 1px solid #aaaaaa;
    padding: 12px;
    background: #eeeeee;
  }
  .title{
    height: 50px;
    font-size: 20px;
  }
  .subTitle{
    height: 30px;
    font-size: 16px;
  }
  .item{
    height: 30px;
  }
  .red{
    color: #ff0000;
  }
  .button{
    margin-right: 8px;
    margin-bottom: 12px;
    width: 120px;
    height: 30px;
    background: #1890ff;
    color: #fff;
    text-shadow: 0 -1px 0 rgb(0 0 0 / 12%);
    box-shadow: 0 2px 0 rgb(0 0 0 / 5%);
    line-height: 1.499;
    position: relative;
    display: inline-block;
    font-weight: 400;
    white-space: nowrap;
    text-align: center;
    background-image: none;
    cursor: pointer;
    transition: all .3s cubic-bezier(.645,.045,.355,1);
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    touch-action: manipulation;
    padding: 0 15px;
    font-size: 14px;
    border-radius: 4px;
    border: 1px solid #d9d9d9;
  }

  .button:focus, .button:hover{
    color: #40a9ff;
    background-color: #fff;
    border-color: #40a9ff;
  }

  .item-label{
    display: inline-block;
    width: 90px;
    text-align: right;
  }
</style>